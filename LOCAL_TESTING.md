# üß™ Local Testing - LINE Betting Bot

## ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏ô Local

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡πÄ‡∏õ‡∏¥‡∏î ngrok tunnel

```bash
ngrok http 3001
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏´‡πá‡∏ô:**
```
ngrok                                                       (Ctrl+C to quit)

Session Status                online
Account                       <your-account>
Version                        3.x.x
Region                         us (United States)
Forwarding                     https://abc123.ngrok.io -> http://localhost:3001
Connections                   0/20
```

**‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL:** `https://abc123.ngrok.io`

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Webhook URL ‡πÉ‡∏ô LINE Bot Console

1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà https://developers.line.biz/console/
2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Channel
3. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà **Messaging API**
4. ‡∏´‡∏≤ **Webhook URL** section
5. ‡πÉ‡∏™‡πà URL ‡∏à‡∏≤‡∏Å ngrok:
   ```
   https://abc123.ngrok.io/webhook
   ```
6. ‡∏Ñ‡∏•‡∏¥‡∏Å **Verify**
7. ‡πÄ‡∏õ‡∏¥‡∏î **Use webhook** toggle

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ‡πÄ‡∏õ‡∏¥‡∏î Terminal ‡πÉ‡∏´‡∏°‡πà ‡πÅ‡∏•‡∏∞ start server

```bash
npm start
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏´‡πá‡∏ô:**
```
üîß Initializing Google Sheets...
‚úÖ Google Sheets access verified
üìù Clearing old headers and creating new ones...
‚úÖ Headers created
Google Sheets initialized
LINE OA Chat Tracker listening on port 3001
```

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö

1. ‡πÄ‡∏û‡∏¥‡πà‡∏° LINE Bot ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÅ‡∏ä‡∏ó
2. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏Å: `"‡∏ä‡∏• 500 ‡∏°‡∏∞‡∏õ‡∏£‡∏≤‡∏á"`
3. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö: `"‡∏ñ 500 ‡∏≠‡πâ‡∏ß‡∏ô"` (‡πÉ‡∏ä‡πâ Reply feature)

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 5: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Logs

‡∏î‡∏π‡∏ó‡∏µ‡πà Terminal ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î server:

**Log ‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏´‡πá‡∏ô:**
```
üîî Webhook received
   Body: { events: [...] }
üì® Webhook handler started
   Events count: 1
   Processing event type: message
      ‚úÖ Extracted message: "‡∏ä‡∏• 500 ‡∏°‡∏∞‡∏õ‡∏£‡∏≤‡∏á"
   ‚úÖ Message extracted: "‡∏ä‡∏• 500 ‡∏°‡∏∞‡∏õ‡∏£‡∏≤‡∏á"
üì® Processing message
   From: U1111111111111111111111111111111
   Text: "‡∏ä‡∏• 500 ‡∏°‡∏∞‡∏õ‡∏£‡∏≤‡∏á"
   Group: Ce73f7032aa63204dcfc2d5685719565b
   ReplyToken: token_xxx
‚è≠Ô∏è  No pair detected (waiting for reply)
```

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 6: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Pair Detection

‡πÄ‡∏°‡∏∑‡πà‡∏≠ User B ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏´‡πá‡∏ô:

```
‚úÖ Pair detected
   User A: U1111111111111111111111111111111
   User B: U2222222222222222222222222222222
üì§ Recording to Google Sheets...
   üìä Row data (14 columns):
      [0]: "2026-01-15T12:12:08.000Z"
      [1]: "U1111111111111111111111111111111"
      [2]: ""
      [3]: "‡∏ä‡∏• 500 ‡∏°‡∏∞‡∏õ‡∏£‡∏≤‡∏á"
      [4]: ""
      [5]: "‡∏ä‡∏•"
      [6]: "500"
      [7]: "500"
      ...
   ‚úÖ Row appended successfully to row 3
‚úÖ Pair recorded successfully
```

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 7: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Google Sheets

1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà https://sheets.google.com
2. ‡πÄ‡∏õ‡∏¥‡∏î Sheet ‡∏ä‡∏∑‡πà‡∏≠ "Bets"
3. ‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

---

## üîß ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤

### ‚ùå ngrok ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
```bash
# ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á ngrok
brew install ngrok

# ‡∏´‡∏£‡∏∑‡∏≠
brew upgrade ngrok
```

### ‚ùå Webhook ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ ngrok ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà
2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Webhook URL ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ "Use webhook" toggle ‡πÄ‡∏õ‡∏¥‡∏î
4. ‡∏•‡∏≠‡∏á‡∏Ñ‡∏•‡∏¥‡∏Å **Verify** ‡πÉ‡∏´‡∏°‡πà

### ‚ùå Google Sheets ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö `GOOGLE_SHEET_ID` ‡πÉ‡∏ô `.env`
2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö `GOOGLE_SERVICE_ACCOUNT_KEY` ‡πÉ‡∏ô `.env`
3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö logs ‡∏ß‡πà‡∏≤ error ‡∏≠‡∏∞‡πÑ‡∏£

### ‚ùå Pair ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ User B ‡πÉ‡∏ä‡πâ Reply feature
2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö logs ‡∏ß‡πà‡∏≤ replyToken ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

---

## üìä ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å

| Timestamp | User A | Message | Bet Type | Amount | User B |
|-----------|--------|---------|----------|--------|--------|
| 2026-01-15T12:12:08.000Z | U111... | ‡∏ä‡∏• 500 ‡∏°‡∏∞‡∏õ‡∏£‡∏≤‡∏á | ‡∏ä‡∏• | 500 | U222... |

---

## üéØ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏£‡πá‡∏ß

1. ‡πÄ‡∏õ‡∏¥‡∏î Terminal 1: `ngrok http 3001`
2. ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡∏à‡∏≤‡∏Å ngrok
3. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Webhook URL ‡πÉ‡∏ô LINE Bot Console
4. ‡πÄ‡∏õ‡∏¥‡∏î Terminal 2: `npm start`
5. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö
6. ‡∏î‡∏π‡∏ó‡∏µ‡πà logs
7. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Google Sheets

---

## üí° ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö

### ‡∏î‡∏π‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ß‡πà‡∏≤ Logs ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
- ‡∏ó‡∏∏‡∏Å webhook request ‡πÅ‡∏™‡∏î‡∏á log
- ‡∏ó‡∏∏‡∏Å pair detection ‡πÅ‡∏™‡∏î‡∏á log
- ‡∏ó‡∏∏‡∏Å Google Sheets write ‡πÅ‡∏™‡∏î‡∏á log

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á
- ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á
- ‡∏î‡∏π‡∏ß‡πà‡∏≤ logs ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡πÑ‡∏´‡∏°
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Google Sheets ‡∏ß‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏´‡∏°

### ‡πÉ‡∏ä‡πâ Reply feature
- ‡∏Å‡∏î reply ‡∏ö‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
- ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà forward ‡∏´‡∏£‡∏∑‡∏≠ copy-paste

---

## üöÄ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏ô local ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:
1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Webhook URL ‡πÉ‡∏ô LINE Bot Console ‡πÄ‡∏õ‡πá‡∏ô Render.com URL
2. Push code ‡πÑ‡∏õ‡∏¢‡∏±‡∏á GitHub
3. Render.com ‡∏à‡∏∞ auto-deploy

**Webhook URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Render.com:**
```
https://line-betting-bot.onrender.com/webhook
```

---

## üìù Notes

- ngrok URL ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î (‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ free plan)
- ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Webhook URL ‡πÉ‡∏ô LINE Bot Console ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
- ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ URL ‡πÄ‡∏î‡∏¥‡∏° ‡πÉ‡∏´‡πâ upgrade ngrok ‡πÄ‡∏õ‡πá‡∏ô paid plan

---

**‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏ô local ‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏≠‡∏±‡∏õ‡πÑ‡∏õ server!** ‚úÖ
